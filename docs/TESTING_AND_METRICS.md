# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É –º–µ—Ç—Ä–∏–∫.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

**HTTP Endpoint:** `GET /health`

```bash
curl https://sessions-ws-production.up.railway.app/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "queueLength": 0
}
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- –û—á–µ—Ä–µ–¥—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–ª–∏–∑–∫–∞ –∫ 0)

---

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

**HTTP Endpoint:** `GET /metrics`

```bash
curl https://sessions-ws-production.up.railway.app/metrics
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "uptime": 3600,
  "activeSessions": 5,
  "totalTranscripts": 1234,
  "queue": {
    "queueLength": 2,
    "pendingSegments": 2
  },
  "latency": {
    "gladia.stt_latency_ms": {
      "count": 500,
      "avgMs": 450,
      "minMs": 200,
      "maxMs": 1200
    },
    "ingest.broadcast_latency_ms": {
      "count": 500,
      "avgMs": 2,
      "minMs": 1,
      "maxMs": 5
    },
    "ws.broadcast_loop_ms": {
      "count": 500,
      "avgMs": 1,
      "minMs": 0,
      "maxMs": 3
    }
  }
}
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- `uptime` ‚Äî –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- `activeSessions` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- `totalTranscripts` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤
- `queue` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–ø–∏—Å–∏ –≤ –ë–î
- `latency` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –∑–∞–¥–µ—Ä–∂–µ–∫ (—Å–º. –Ω–∏–∂–µ)

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–¥–µ—Ä–∂–µ–∫

### –¢–∏–ø—ã –º–µ—Ç—Ä–∏–∫

#### 1. `gladia.stt_latency_ms`

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç:** –ó–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ Gladia (–æ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ—á–∏ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞)

**–ö–∞–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è:**
```typescript
const sttLatency = Date.now() - event.endedAt.getTime()
recordLatency('gladia.stt_latency_ms', sttLatency)
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- **Min:** 200-300ms
- **Avg:** 400-600ms
- **Max:** 800-1200ms

**–ß—Ç–æ –≤–ª–∏—è–µ—Ç:**
- –î–ª–∏–Ω–∞ —Ñ—Ä–∞–∑—ã (–¥–ª–∏–Ω–Ω–µ–µ = –±–æ–ª—å—à–µ –∑–∞–¥–µ—Ä–∂–∫–∞)
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ—á–∏
- –Ø–∑—ã–∫ (—Ä—É—Å—Å–∫–∏–π –æ–±—ã—á–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ)
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Gladia

**–ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏:**
- Avg > 1000ms ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é –∏–ª–∏ Gladia
- Max > 2000ms ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

---

#### 2. `ingest.broadcast_latency_ms`

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç:** –ó–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ RTMP Ingest (–æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞ –æ—Ç Gladia –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞–º)

**–ö–∞–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è:**
```typescript
const ingestLatency = broadcastEnd - broadcastBody.ts
recordLatency('ingest.broadcast_latency_ms', ingestLatency)
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- **Min:** 1-2ms
- **Avg:** 2-5ms
- **Max:** 5-10ms

**–ß—Ç–æ –≤–ª–∏—è–µ—Ç:**
- –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ Node.js
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU

**–ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏:**
- Avg > 20ms ‚Äî –≤–æ–∑–º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- Max > 50ms ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

---

#### 3. `ws.broadcast_loop_ms`

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç:** –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `broadcastToSessionClients()` (direct mode)

**–ö–∞–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è:**
```typescript
const broadcastStart = Date.now()
broadcastToSessionClients(sessionSlug, payload)
const broadcastEnd = Date.now()
recordLatency('ws.broadcast_loop_ms', broadcastEnd - broadcastStart)
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- **Min:** 0-1ms
- **Avg:** 1-3ms
- **Max:** 3-10ms

**–ß—Ç–æ –≤–ª–∏—è–µ—Ç:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Å–µ—Å—Å–∏–∏
- –°–∫–æ—Ä–æ—Å—Ç—å WebSocket –æ—Ç–ø—Ä–∞–≤–∫–∏

**–ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏:**
- Avg > 10ms ‚Äî —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
- Max > 50ms ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

---

#### 4. `http.post_latency_ms` (—Ç–æ–ª—å–∫–æ –≤ HTTP mode)

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç:** –ó–∞–¥–µ—Ä–∂–∫–∞ HTTP POST –∑–∞–ø—Ä–æ—Å–∞ (RTMP —Å–µ—Ä–≤–∏—Å ‚Üí WebSocket —Å–µ—Ä–≤–µ—Ä)

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- **Min:** 50-100ms
- **Avg:** 100-300ms
- **Max:** 300-500ms

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í direct mode —ç—Ç–∞ –º–µ—Ç—Ä–∏–∫–∞ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è (HTTP —Ö–æ–ø –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–µ—Å—Å–∏—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í–∫–ª—é—á–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω
3. –ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ: "–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ —Ç–µ—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –ø–æ—è–≤–∏–ª—Å—è –≤ UI

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –ø–æ—è–≤–∏–ª—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —Å–µ–∫—É–Ω–¥
- –¢–µ–∫—Å—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–∫–∞–∑–∞–Ω–Ω–æ–º—É
- –ò–º—è —Å–ø–∏–∫–µ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏
curl https://sessions-ws-production.up.railway.app/metrics | jq '.latency'
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `gladia.stt_latency_ms.avgMs` < 800ms
- `ingest.broadcast_latency_ms.avgMs` < 10ms
- `ws.broadcast_loop_ms.avgMs` < 5ms

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–µ—Å—Ç –∑–∞–¥–µ—Ä–∂–∫–∏

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ù–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏ `[CLIENT_METRICS] transcript_latency_ms`
3. –ì–æ–≤–æ—Ä–∏—Ç–µ —Ñ—Ä–∞–∑—ã –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–æ—Ç `ts` –≤ payload –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å < 100ms (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ç—å)

**–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:**
```
[CLIENT_METRICS] transcript_latency_ms 45
[CLIENT_METRICS] transcript_latency_ms 52
[CLIENT_METRICS] transcript_latency_ms 38
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (–¥–ª–∏—Ç–µ–ª—å–Ω—ã–π –∑–≤–æ–Ω–æ–∫)

**–®–∞–≥–∏:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Å—Å–∏—é –Ω–∞ 10-15 –º–∏–Ω—É—Ç
2. –ì–æ–≤–æ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
3. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥—ã–µ 2-3 –º–∏–Ω—É—Ç—ã

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ù–µ—Ç —Ä–æ—Å—Ç–∞ –∑–∞–¥–µ—Ä–∂–µ–∫ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
- –ù–µ—Ç —Ä–∞–∑—Ä—ã–≤–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Gladia
- FFmpeg –Ω–µ –ø–∞–¥–∞–µ—Ç
- –ü–∞–º—è—Ç—å –Ω–µ —Ä–∞—Å—Ç–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
watch -n 120 'curl -s https://sessions-ws-production.up.railway.app/metrics | jq "{uptime, activeSessions, latency}"'
```

**–ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏:**
- `activeSessions` —Ä–∞—Å—Ç–µ—Ç –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (—É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏)
- `latency.*.avgMs` —Ä–∞—Å—Ç–µ—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º (–¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- `queue.queueLength` > 100 (–ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø–∏—Å—å—é –≤ –ë–î)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –¢–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ 6 —Å–æ–æ–±—â–µ–Ω–∏–π

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–µ—Å—Å–∏—é
2. –ì–æ–≤–æ—Ä–∏—Ç–µ –±–æ–ª–µ–µ 6 —Ñ—Ä–∞–∑ –ø–æ–¥—Ä—è–¥
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 6 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è
- –í—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ 6 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–Ω–∏–∑—É

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ª–æ–≥–∞—Ö Railway

### –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

#### 1. –ó–∞–ø—É—Å–∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

**–ò—â–∏—Ç–µ:**
```
[WS-SERVER] ‚úÖ Transcription started successfully for session {sessionId}
[RoomCompositeTranscriber] ‚úÖ Room Composite Egress started: {egressId}
[RTMPIngest] ‚úÖ RTMP Ingest initialized for session {sessionId}
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

#### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ RTMP –ø–æ—Ç–æ–∫–∞

**–ò—â–∏—Ç–µ:**
```
[RTMPServer] üîµ RTMP client connecting: {streamPath}
[RTMPServer] ‚úÖ RTMP stream connecting: {streamPath}
[RTMPIngest] ‚úÖ LiveKit Egress connected to RTMP stream: {streamPath}
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- LiveKit Egress –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ RTMP —Å–µ—Ä–≤–µ—Ä—É
- FFmpeg –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ï—Å–ª–∏ —ç—Ç–∏—Ö –ª–æ–≥–æ–≤ –Ω–µ—Ç ‚Üí Egress –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `RTMP_HOST`, `RTMP_EXTERNAL_PORT`)

---

#### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤

**–ò—â–∏—Ç–µ:**
```
[RTMPIngest] üì® Received transcript from Gladia {
  textPreview: "...",
  isFinal: true,
  gladiaProcessingTimeMs: 450
}
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- Gladia –æ–±—Ä–∞–±–æ—Ç–∞–ª –∞—É–¥–∏–æ –∏ –≤–µ—Ä–Ω—É–ª —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç
- `gladiaProcessingTimeMs` ‚Äî –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ Gladia

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ï—Å–ª–∏ –ª–æ–≥–æ–≤ –Ω–µ—Ç ‚Üí FFmpeg –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ –≤ Gladia (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ FFmpeg)

---

#### 4. –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–¥–µ—Ä–∂–µ–∫ (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ)

**–ò—â–∏—Ç–µ:**
```
[METRICS] gladia.stt_latency_ms {
  count: 100,
  avgMs: 450,
  minMs: 200,
  maxMs: 1200
}
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ù–∞–∫–æ–ø–ª–µ–Ω–æ 100 —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤
- –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ 450ms
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è 200ms, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è 1200ms

**–õ–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø–∏—Å–µ–π** (—Å–º. `server/realtime-metrics.ts`)

---

#### 5. –û—à–∏–±–∫–∏

**–ò—â–∏—Ç–µ:**
```
[RTMPIngest] FFmpeg exited with code 1
[GladiaBridge] WebSocket closed { code: 4408, reason: 'No audio chunk received for 30s' }
[RTMPIngest] Failed to post transcript to WS broadcast
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- FFmpeg —É–ø–∞–ª (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Ç—Ä–∞–π –¥–æ–ª–∂–µ–Ω –ø–æ–º–æ—á—å)
- Gladia –∑–∞–∫—Ä—ã–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–Ω–µ—Ç –∞—É–¥–∏–æ 30 —Å–µ–∫—É–Ω–¥)
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞–º

---

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –º–µ—Ç—Ä–∏–∫

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test-metrics.sh`:

```bash
#!/bin/bash

WS_URL="https://sessions-ws-production.up.railway.app"

echo "=== Health Check ==="
curl -s "$WS_URL/health" | jq '.'

echo ""
echo "=== Metrics ==="
curl -s "$WS_URL/metrics" | jq '{
  uptime,
  activeSessions,
  totalTranscripts,
  queue: .queue.queueLength,
  latency: .latency | to_entries | map({
    name: .key,
    count: .value.count,
    avgMs: .value.avgMs,
    minMs: .value.minMs,
    maxMs: .value.maxMs
  })
}'
```

**–ó–∞–ø—É—Å–∫:**
```bash
chmod +x test-metrics.sh
./test-metrics.sh
```

---

### –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–°–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥:**

```bash
#!/bin/bash

WS_URL="https://sessions-ws-production.up.railway.app"

while true; do
  clear
  echo "=== $(date) ==="
  echo ""
  
  # Health
  HEALTH=$(curl -s "$WS_URL/health")
  echo "Health: $(echo $HEALTH | jq -r '.status')"
  echo "Queue: $(echo $HEALTH | jq -r '.queueLength')"
  echo ""
  
  # Latency metrics
  METRICS=$(curl -s "$WS_URL/metrics")
  echo "=== Latency Metrics ==="
  echo "$METRICS" | jq -r '.latency | to_entries[] | "\(.key): avg=\(.value.avgMs)ms, min=\(.value.minMs)ms, max=\(.value.maxMs)ms, count=\(.value.count)"'
  
  sleep 30
done
```

---

## –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

- [ ] Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `status: "ok"`
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `/metrics`
- [ ] `gladia.stt_latency_ms.avgMs` < 800ms
- [ ] `ingest.broadcast_latency_ms.avgMs` < 10ms
- [ ] `ws.broadcast_loop_ms.avgMs` < 5ms
- [ ] –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ UI –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —Å–µ–∫—É–Ω–¥
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 6 —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Railway
- [ ] FFmpeg –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏—è—Ö
- [ ] –ü–∞–º—è—Ç—å –Ω–µ —Ä–∞—Å—Ç–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

---

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫

### –•–æ—Ä–æ—à–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

```json
{
  "gladia.stt_latency_ms": {
    "avgMs": 450,
    "minMs": 200,
    "maxMs": 800
  },
  "ingest.broadcast_latency_ms": {
    "avgMs": 2,
    "minMs": 1,
    "maxMs": 5
  },
  "ws.broadcast_loop_ms": {
    "avgMs": 1,
    "minMs": 0,
    "maxMs": 3
  }
}
```

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ, –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã.

---

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

```json
{
  "gladia.stt_latency_ms": {
    "avgMs": 1500,
    "minMs": 800,
    "maxMs": 3000
  },
  "ingest.broadcast_latency_ms": {
    "avgMs": 50,
    "minMs": 10,
    "maxMs": 200
  }
}
```

**–í—ã–≤–æ–¥:** 
- Gladia –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é (avgMs > 1000ms)
- RTMP —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω (ingest.broadcast_latency_ms > 20ms)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Gladia –Ω–∞ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä (CPU, –ø–∞–º—è—Ç—å)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
curl http://localhost:3000/metrics | jq '.'
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ Railway

```bash
# –ß–µ—Ä–µ–∑ Railway CLI
railway logs --service ws-server --follow
```

### –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

```bash
# –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ FFmpeg
railway logs --service ws-server | grep "FFmpeg"

# –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ Gladia
railway logs --service ws-server | grep "GladiaBridge"

# –ò—â–∏—Ç–µ –º–µ—Ç—Ä–∏–∫–∏
railway logs --service ws-server | grep "METRICS"
```

---

## –†–µ–∑—é–º–µ

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
1. `gladia.stt_latency_ms` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ Gladia (—Ü–µ–ª—å: < 800ms)
2. `ingest.broadcast_latency_ms` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ ingest (—Ü–µ–ª—å: < 10ms)
3. `ws.broadcast_loop_ms` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ broadcast (—Ü–µ–ª—å: < 5ms)

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `/health` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `/metrics` ‚Äî –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏:**
- `[RTMPIngest] üì® Received transcript from Gladia` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞
- `[METRICS]` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (–∫–∞–∂–¥—ã–µ 100 –∑–∞–ø–∏—Å–µ–π)

