# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ WebSocket "Invalid frame header" –Ω–∞ Railway

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ handshake –±—Ä–∞—É–∑–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç "Invalid frame header"

**–°—Ç–∞—Ç—É—Å:** URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, handshake –ø—Ä–æ—Ö–æ–¥–∏—Ç, –Ω–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ WebSocket —Ñ—Ä–µ–π–º—ã

---

## –ß—Ç–æ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (Frontend)

‚úÖ **WebSocket URL —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
- Production: `wss://sessions-ws-production.up.railway.app/api/realtime/transcribe?token=...`
- –í—Å–µ–≥–¥–∞ `wss://` –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞
- –ë–µ–∑ –ø–æ—Ä—Ç–∞ –¥–ª—è production

‚úÖ **Handshake –ø—Ä–æ—Ö–æ–¥–∏—Ç:**
- `onopen` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "Connected successfully"

‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ handshake —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ WebSocket —Ñ—Ä–µ–π–º—ã

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ wscat

**–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:**

```bash
# –ü–æ–ª—É—á–∏—Ç–µ –≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ (–∏–∑ –ª–æ–≥–æ–≤ –∏–ª–∏ Network tab)
npx wscat -c "wss://sessions-ws-production.up.railway.app/api/realtime/transcribe?token=–í–ê–®_–¢–û–ö–ï–ù"
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ª–∏?
- –°—ã–ø—è—Ç—Å—è –ª–∏ –ª–æ–≥–∏/–º—É—Å–æ—Ä —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∫–æ–Ω–Ω–µ–∫—Ç–∞?
- –ù–µ –≤—ã–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è –ª–∏ —Å –ø–æ—Ö–æ–∂–µ–π –æ—à–∏–±–∫–æ–π?

**–ï—Å–ª–∏ wscat —Ç–æ–∂–µ —Ä–≤—ë—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç** ‚Üí 100% –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–µ—Ä–≤–µ—Ä–µ/–ø—Ä–æ–∫—Å–∏

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Railway

**–í Railway ‚Üí –í–∞—à —Å–µ—Ä–≤–∏—Å ‚Üí Logs:**

–ò—â–∏—Ç–µ:
```
[WS-SERVER] üîÑ Upgrade request: /api/realtime/transcribe
[WS-SERVER] ‚úÖ WebSocket connection established: /api/realtime/transcribe?token=...
```

**–ï—Å–ª–∏ —ç—Ç–∏—Ö –ª–æ–≥–æ–≤ –Ω–µ—Ç:**
- –ó–∞–ø—Ä–æ—Å –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ Railway –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–∏

**–ï—Å–ª–∏ –ª–æ–≥–∏ –µ—Å—Ç—å, –Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–≤—ë—Ç—Å—è:**
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ WebSocket –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –í–æ–∑–º–æ–∂–Ω–æ, RTMP —Å–µ—Ä–≤–µ—Ä –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞

**–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:**

1. **–°–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç:**
   ```typescript
   const port = Number(process.env.PORT) || 3001
   server.listen(port, ...)
   ```

2. **WebSocketServer –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:**
   ```typescript
   const wss = new WebSocketServer({
     server,  // –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ http.Server
     path: '/api/realtime/transcribe',
   })
   ```

3. **–ù–µ—Ç HTTP-—Ä–æ—É—Ç–æ–≤ –Ω–∞ `/api/realtime/transcribe`:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç `app.get('/api/realtime/transcribe', ...)`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç middleware, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç –ø—É—Ç—å

4. **RTMP —Å–µ—Ä–≤–µ—Ä –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç:**
   - RTMP —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ä—Ç—É (1935)
   - –ù–µ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ `http.Server`

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Railway Settings

**Railway ‚Üí –í–∞—à —Å–µ—Ä–≤–∏—Å ‚Üí Settings ‚Üí Networking:**

1. **Public Networking:**
   - Port –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "DEFAULT" –∏–ª–∏ "Auto-detect"
   - –ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Ä—Ç (8000, 5000, –∏ —Ç.–¥.)

2. **Variables:**
   - –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `PORT` –∏–ª–∏ `WS_PORT`
   - Railway —Å–∞–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `PORT`

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è Railway

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
Railway –º–æ–∂–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å WebSocket –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –µ—Å–ª–∏:
- Target Port —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—Ä—É—á–Ω—É—é
- –ï—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å RTMP –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Target Port = "DEFAULT"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RTMP –ø—Ä–æ–∫—Å–∏ (–ø–æ—Ä—Ç 1935) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. RTMP —Å–µ—Ä–≤–µ—Ä –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:**
RTMP —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RTMP —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ—Ä—Ç—É 1935
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RTMP —Å–µ—Ä–≤–µ—Ä –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ `http.Server`

### 2. Railway –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
Railway –º–æ–∂–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å WebSocket –∫–∞–∫ –æ–±—ã—á–Ω—ã–π HTTP, –µ—Å–ª–∏ Target Port –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Target Port = "DEFAULT"
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å

### 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ upgrade –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:**
WebSocketServer –º–æ–∂–µ—Ç –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å upgrade –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WebSocketServer —Å–æ–∑–¥–∞–Ω –î–û –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `server.on('upgrade')`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `http.Server`

### 4. HTTP-—Ä–æ—É—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ï—Å–ª–∏ –µ—Å—Ç—å HTTP-—Ä–æ—É—Ç –Ω–∞ `/api/realtime/transcribe`, –æ–Ω –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã.

**–†–µ—à–µ–Ω–∏–µ:**
- –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ HTTP-—Ä–æ—É—Ç—ã –Ω–∞ `/api/realtime/transcribe`
- –û—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–ª—å–∫–æ WebSocket –æ–±—Ä–∞–±–æ—Ç–∫—É

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ wscat
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Railway
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–µ—Ä–∞
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Railway Settings
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RTMP —Å–µ—Ä–≤–µ—Ä

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024-12-28

